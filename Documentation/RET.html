<!DOCTYPE html>
<html>
<head>
  <title>StackVM Instruction Documentation | RET_E</title>
  <link rel="stylesheet" type="text/css" href="DocStyle.css"/>
</head>
<body>
  <h1>RET (Return Instruction)</h1>
  <p>RET and RET_N2 are instructions 126 (0x7E) and 127 (0x7F) respectively. They instruct the processor to perform a return to the address and base pointer on the stack.</p>
  <p>In addition, RET_N2 will reset the final stack by n bytes where n is a 16 bit unsigned integer operand on the stack before the stack change</p>
  <p><strong>NOTE: This instruction sets the stack pointer to the base pointer to then retreive the return address and return base pointer</strong></p>
  <div>
    <h3>Stack Diagram</h3>
    <span>((<strong>STACK_CHANGE</strong> sp=bp))-></span>
    <ul class="stack">
      <li>8-byte prev_bp</li>
      <li>8-byte prev_ip</li>
    </ul>
    <span>->RET-></span>
    <ul class="stack">
      <li>NONE</li>
    </ul>
    <br/>
    <ul class="stack">
      <li>2-byte A</li>
    </ul>
    <span>->((<strong>STACK_CHANGE</strong> sp=bp))-></span>
    <ul class="stack">
      <li>8-byte prev_bp</li>
      <li>8-byte prev_ip</li>
      <li>(A)-byte stuff</li>
    </ul>
    <span>->RET_N2-></span>
    <ul class="stack">
      <li>NONE</li>
    </ul>
  </div>
  <p>RET_N2 will, after the STACK_CHANGE, reset the stack by A bytes, then pop prev_bp and prev_ip.</p>
  <p>RET and RET_N2 will set bp=prev_bp and jump to prev_ip.</p>
</body>
</html>
